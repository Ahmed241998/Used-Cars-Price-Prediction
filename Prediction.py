import streamlit as st 
import pandas as pd
import numpy as np
import plotly.express as px
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.impute import KNNImputer,SimpleImputer
from sklearn.compose import ColumnTransformer 
from sklearn.preprocessing import OneHotEncoder , StandardScaler , LabelEncoder , MinMaxScaler , RobustScaler
from category_encoders import BinaryEncoder
from imblearn.pipeline import make_pipeline
from sklearn.linear_model import LinearRegression
from sklearn.neighbors import KNeighborsRegressor
from sklearn.preprocessing import PolynomialFeatures
from sklearn.decomposition import PCA
from sklearn.metrics import accuracy_score 
from sklearn.feature_selection import SelectFromModel
from sklearn.tree import DecisionTreeRegressor
from sklearn.ensemble import RandomForestRegressor
from sklearn.svm import SVC
from sklearn.metrics import confusion_matrix , ConfusionMatrixDisplay
from sklearn.model_selection import cross_validate , train_test_split , StratifiedKFold , GridSearchCV , RandomizedSearchCV
from sklearn import set_config
from xgboost import XGBRegressor
import joblib
def app() :
    st.title('Used Cars Price Prediction')
    df=pd.read_csv('Cleaned_Vehicles_Data.csv')
    df.drop('Unnamed: 0',axis=1,inplace=True)
    XGB=joblib.load('XGB')
    man =  st.selectbox(
    'Please, Select The Manufacturer',
    df['manufacturer'].unique()
    ,index=0,
    placeholder="Select Manufacturer...")
    cond =  st.selectbox(
    'Please, Select The Condition with considering that new condition is like new condition and salvage condition is fair condition',
    df['condition'].unique()
    ,index=None,
    placeholder="Select Condition Of The Car...")
    cylinder =  st.selectbox(
    'Please, Select The Number of Cylinders',
    df['cylinders'].unique(),index=None,
    placeholder="Select Number Of Cylinders...")
    fuel =  st.selectbox(
    'Please, Select The Fuel Type',
    df['fuel'].unique(),index=None,
    placeholder="Select Fuel Type...")
    tit =  st.selectbox(
    'Please, Select The Title Status',
    df['title_status'].unique(),index=None,
    placeholder="Select Title Status Of The Car...")
    trans =  st.selectbox(
    'Please, Select The Transmission Type',
    df['transmission'].unique(),index=None,
    placeholder="Select Transmiision Type...")
    drive =  st.selectbox(
    'Please, Select The Drive Type',
    df['drive'].unique(),index=None,
    placeholder="Select Drive Type...")
    dct = {'audi': ['hatchback',
  'coupe',
  'truck',
  'wagon',
  'other',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'chevrolet': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'convertible',
  'other',
  'van',
  'bus',
  'pickup',
  'wagon',
  'suv',
  'sedan'],
 'cadillac': ['hatchback',
  'coupe',
  'truck',
  'wagon',
  'other',
  'bus',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'acura': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'wagon',
  'other',
  'van',
  'suv',
  'convertible',
  'sedan'],
 'bmw': ['hatchback',
  'coupe',
  'truck',
  'wagon',
  'other',
  'bus',
  'suv',
  'convertible',
  'sedan'],
 'chrysler': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'van',
  'suv',
  'convertible',
  'sedan'],
 'ford': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'convertible',
  'other',
  'van',
  'bus',
  'pickup',
  'wagon',
  'suv',
  'sedan'],
 'buick': ['hatchback',
  'coupe',
  'mini-van',
  'wagon',
  'other',
  'van',
  'suv',
  'convertible',
  'sedan'],
 'infiniti': ['hatchback',
  'coupe',
  'truck',
  'wagon',
  'other',
  'suv',
  'convertible',
  'sedan'],
 'gmc': ['hatchback',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'van',
  'bus',
  'pickup',
  'suv',
  'sedan'],
 'honda': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'van',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'hyundai': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'wagon',
  'other',
  'van',
  'pickup',
  'suv',
  'sedan'],
 'jeep': ['hatchback',
  'coupe',
  'offroad',
  'wagon',
  'convertible',
  'other',
  'van',
  'pickup',
  'truck',
  'suv',
  'sedan'],
 'dodge': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'convertible',
  'other',
  'van',
  'bus',
  'pickup',
  'wagon',
  'suv',
  'sedan'],
 'jaguar': ['hatchback',
  'coupe',
  'wagon',
  'other',
  'suv',
  'convertible',
  'sedan'],
 'kia': ['hatchback',
  'coupe',
  'mini-van',
  'wagon',
  'other',
  'van',
  'bus',
  'suv',
  'sedan'],
 'land rover': ['offroad', 'other', 'truck', 'suv', 'sedan'],
 'lexus': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'suv',
  'convertible',
  'sedan'],
 'mercedes-benz': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'van',
  'bus',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'mitsubishi': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'convertible',
  'other',
  'van',
  'bus',
  'pickup',
  'wagon',
  'suv',
  'sedan'],
 'lincoln': ['hatchback',
  'coupe',
  'truck',
  'wagon',
  'other',
  'bus',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'mazda': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'wagon',
  'other',
  'van',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'nissan': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'convertible',
  'other',
  'van',
  'bus',
  'pickup',
  'wagon',
  'suv',
  'sedan'],
 'mini': ['hatchback',
  'coupe',
  'mini-van',
  'offroad',
  'wagon',
  'other',
  'van',
  'bus',
  'suv',
  'convertible',
  'sedan'],
 'porsche': ['hatchback',
  'coupe',
  'truck',
  'wagon',
  'other',
  'suv',
  'convertible',
  'sedan'],
 'ram': ['hatchback',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'van',
  'bus',
  'pickup',
  'suv',
  'sedan'],
 'subaru': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'pickup',
  'suv',
  'sedan'],
 'toyota': ['hatchback',
  'mini-van',
  'coupe',
  'truck',
  'offroad',
  'wagon',
  'other',
  'van',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'volkswagen': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'offroad',
  'wagon',
  'other',
  'van',
  'bus',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'volvo': ['hatchback',
  'sedan',
  'coupe',
  'suv2020',
  'truck',
  'offroad',
  'wagon',
  'other',
  'suv',
  'convertible',
  'suv1992'],
 'fiat': ['hatchback',
  'coupe',
  'wagon',
  'other',
  'suv',
  'convertible',
  'sedan'],
 'tesla': ['hatchback', 'wagon', 'other', 'suv', 'sedan'],
 'ferrari': ['hatchback', 'coupe', 'other', 'convertible', 'sedan'],
 'mercury': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'wagon',
  'other',
  'van',
  'pickup',
  'suv',
  'convertible',
  'sedan'],
 'pontiac': ['hatchback',
  'coupe',
  'mini-van',
  'wagon',
  'other',
  'van',
  'suv',
  'convertible',
  'sedan'],
 'saturn': ['hatchback',
  'coupe',
  'mini-van',
  'truck',
  'wagon',
  'other',
  'van',
  'suv',
  'convertible',
  'sedan'],
 'alfa-romeo': ['hatchback',
  'coupe',
  'wagon',
  'other',
  'suv',
  'convertible',
  'sedan'],
 'aston-martin': ['convertible', 'other', 'coupe', 'sedan'],
 'harley-davidson': ['other', 'pickup', 'truck', 'suv', 'sedan'],
 'datsun': ['hatchback',
  'coupe',
  'other',
  'pickup',
  'truck',
  'convertible',
  'sedan'],
 'rover': ['hatchback',
  'coupe',
  'offroad',
  'wagon',
  'other',
  'pickup',
  'truck',
  'suv',
  'sedan']}
    odometer = st.number_input("The Traveled Distance of car", value=None, placeholder="Insert a number...")
    year = st.number_input("Model Year", value=None, placeholder="Type a number...")
    if 'clicked' not in st.session_state:
      st.session_state.clicked = False
    def set_clicked():
      st.session_state.clicked = True
    st.button('Select', on_click=set_clicked)
    if st.session_state.clicked:
      type =  st.selectbox(
        'Please, Select The Type Of Car',
        dct[man],index=0,
        placeholder="Select Type Of The Car...")
      st.write('You selected:', type)
    if st.button('Submit', type="primary") :
        x , y = df.drop(['price'] , axis = 1) , df['price']
        XGB.fit(x,y)
        pred=XGB.predict(pd.DataFrame(data=[[year,man,cond,cylinder,fuel,odometer,tit,trans,drive,type]],columns=df.columns[1:]))[0]
        st.write('The Expected Price is ',pred)



    
